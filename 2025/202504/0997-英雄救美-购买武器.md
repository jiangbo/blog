# 0997-英雄救美-购买武器

## 目标

可以进入到武器店，和老板对话，可以购买武器。

## 环境

- Time 2025-08-17
- Zig 0.14.1

## 参考

1. 圣剑英雄传：英雄救美源码。

## 想法

实现了购买的功能，还没有做金币不够和背包不够的问题。

## world.zig

```zig
...
const Shop = struct {
    items: [16]u8,
    current: u8 = 0,

    pub fn update(self: *Shop) void {
        self.current = item.update(self.items.len, self.current);

        if (window.isAnyKeyRelease(&.{ .LEFT_CONTROL, .F, .ENTER })) {
            const itemIndex = self.items[self.current];
            if (itemIndex != 0) buy(itemIndex);
        }

        if (window.isKeyRelease(.Q)) status = null;
    }

    fn buy(itemIndex: u8) void {
        const buyItem = item.zon[itemIndex];

        // TODO 金币不够
        if (buyItem.money > player.money) @panic("money not enough");

        const bagEnough = player.addItem(itemIndex);
        //  TODO 背包不够
        if (!bagEnough) @panic("bag not enough");
        player.money -= buyItem.money;
    }

    pub fn draw(self: *const Shop) void {
        item.draw(&self.items, self.current);
        var buffer: [20]u8 = undefined;
        // 金币，操作说明
        camera.drawText("（金=", item.position.addXY(10, 270));
        const moneyStr = zhu.format(&buffer, "{d}）", .{player.money});
        camera.drawText(moneyStr, item.position.addXY(60, 270));
        const text = "CTRL=购买　　ESC=退出";
        camera.drawText(text, item.position.addXY(118, 270));
    }
};
var weaponShop: Shop = .{
    .items = .{
        12, 12, 13, 13, 14, 14, 9, 9, //
        10, 10, 8,  8,  16, 16, 0, 0,
    },
};
...
```

## 效果

![购买武器][1]

[1]: images/英雄救美28.png

## 附录
