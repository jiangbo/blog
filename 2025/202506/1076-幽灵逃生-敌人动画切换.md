# 1076-幽灵逃生-敌人动画切换

## 目标

敌人目前有三个状态，实现三种状态的动画，并且可以进行切换。

## 环境

- Time 2026-01-09
- Zig 0.15.1

## 参考

1. <https://www.bilibili.com/video/BV1jf9XYQEhW>

## 想法

视频教程中涉及到很多继承和内存管理的内容，这里不涉及内存分配。

## enemy.zig

实现敌人的动画绘制。

```zig
const std = @import("std");
const zhu = @import("zhu");

const camera = zhu.camera;

const player = @import("player.zig");

const State = enum { normal, hurt, dead };
const Enemy = struct {
    position: zhu.Vector2,
    animation: zhu.graphics.FrameAnimation,
};
const normalFrames = zhu.graphics.framesX(4, .init(32, 32), 0.2);
const deadFrames = zhu.graphics.framesX(8, .init(32, 32), 0.1);
const size = deadFrames[0].area.size.scale(2);
const maxSpeed = 100;

var animations: zhu.graphics.EnumFrameAnimation(State) = undefined;
var enemy: Enemy = undefined;

pub fn init() void {
    var image = zhu.graphics.getImage("sprite/ghost-Sheet.png");
    animations.set(.normal, .init(image, &normalFrames));
    image = zhu.graphics.getImage("sprite/ghostHurt-Sheet.png");
    animations.set(.hurt, .init(image, &normalFrames)); // 受伤和普通动画一样
    image = zhu.graphics.getImage("sprite/ghostDead-Sheet.png");
    animations.set(.dead, .init(image, &deadFrames));

    // 暂时将动画设置为不重复播放，看看动画切换的效果
    for (&animations.values, 0..) |*animation, i| {
        animation.loop = false;
        animation.state = @intCast(i);
    }

    enemy = Enemy{
        .position = player.position.add(.init(200, 200)),
        .animation = animations.get(.normal),
    };
}

pub fn update(delta: f32) void {
    const dir = player.position.sub(enemy.position);
    const distance = dir.normalize().scale(maxSpeed * delta);
    enemy.position = enemy.position.add(distance);

    if (enemy.animation.isFinishedAfterUpdate(delta)) {
        const next = zhu.nextEnum(State, enemy.animation.state);
        enemy.animation = animations.get(next);
    }
}

pub fn draw() void {
    const image = enemy.animation.currentImage();
    camera.drawImage(image, enemy.position, .{
        .size = size,
    });
}
```

## 效果

![敌人动画切换][1]

[1]: images/幽灵逃生09.gif

## 附录
