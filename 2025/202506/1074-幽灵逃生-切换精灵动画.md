# 1074-幽灵逃生-切换精灵动画

## 目标

实现玩家精灵动画的切换，目前有两套，一套待机，一套移动。

## 环境

- Time 2026-01-09
- Zig 0.15.1

## 参考

1. <https://www.bilibili.com/video/BV1jf9XYQEhW>

## 想法

这里是简单的实现，没有像教程中设计得那么复杂。把背景网格去掉了，不然录制的 gif 很大。

## player.zig

定义玩家的状态，根据状态的切换，显示不同的动画。

```zig
const std = @import("std");
const zhu = @import("zhu");

const camera = zhu.camera;
const window = zhu.window;

const maxSpeed = 500;
const frames = zhu.graphics.framesX(8, .init(48, 48), 0.1);
const size = frames[0].area.size.scale(2);
const Status = enum { idle, move };

var idleImage: zhu.graphics.Image = undefined;
var moveImage: zhu.graphics.Image = undefined;

pub var position: zhu.Vector2 = undefined;
var velocity: zhu.Vector2 = .zero;
var animation: zhu.graphics.FrameAnimation = undefined;
var status: Status = .idle;

pub fn init(initPosition: zhu.Vector2) void {
    idleImage = zhu.graphics.getImage("sprite/ghost-idle.png");
    moveImage = zhu.graphics.getImage("sprite/ghost-move.png");

    animation = .init(idleImage, &frames);
    position = initPosition;
}

pub fn update(delta: f32, worldSize: zhu.Vector2) void {
    velocity = velocity.scale(0.9);
    if (window.isKeyPress(.A)) velocity = .init(-maxSpeed, 0);
    if (window.isKeyPress(.D)) velocity = .init(maxSpeed, 0);
    if (window.isKeyPress(.W)) velocity = .init(0, -maxSpeed);
    if (window.isKeyPress(.S)) velocity = .init(0, maxSpeed);

    move(delta);
    position.clamp(.zero, worldSize.sub(size));
    animation.update(delta);
}

fn move(delta: f32) void {
    position = position.add(velocity.scale(delta));

    const new: Status = if (velocity.length2() < 0.01) .idle else .move;
    if (new == status) return; // 状态未变化
    status = new;
    animation.image = if (new == .move) moveImage else idleImage;
}

pub fn draw() void {
    zhu.batch.drawOption(animation.currentImage(), position, .{
        .size = size,
        .flipX = velocity.x < 0,
    });
}
```

## 效果

![玩家精灵动画][1]

[1]: images/幽灵逃生07.gif

## 附录
