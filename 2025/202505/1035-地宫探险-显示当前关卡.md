# 1035-地宫探险-显示当前关卡

## 目标

将角色当前所在的关卡等级显示到右上角。

## 环境

- Time 2025-11-24
- Zig 0.15.1

## 参考

1. <https://pragprog.com/titles/hwrust/hands-on-rust/>
2. 《Rust游戏开发实战》

## 想法

直接把地图的当前等级显示出来就行，看了一下下一章，感觉不太好做。

## hud.zig

显示当前关卡等级。

```zig
pub fn draw() void {
    camera.mode = .local;
    defer camera.mode = .world;

    var pos: gfx.Vector = .init(window.logicSize.x / 2, 10);
    var healthSize: gfx.Vector = .init(200, 12);
    const healthPos = pos.sub(healthSize.scale(0.5));

    const health = ecs.w.getIdentity(Player, Health).?;
    var buffer: [50]u8 = undefined;
    var text = zhu.format(&buffer, "Health: {} / {}", //
        .{ health.current, health.max });

    camera.drawRect(.init(healthPos, healthSize), healthBackground);
    healthSize.x *= math.percentInt(health.current, health.max);
    camera.drawRect(.init(healthPos, healthSize), healthForeground);

    drawTextCenter(text, pos, .{});
    pos.y += size.x * 2;
    drawTextCenter("Explore the Dungeon. A/S/D/W to move.", pos, .{});

    text = zhu.format(&buffer, "Dungeon Level: {}", .{map.currentLevel});
    const textSize = size.mul(.init(@floatFromInt(text.len), 1));
    const x = window.logicSize.x - textSize.x - 10;
    drawText(text, .init(x, 10), .{});

    if (!map.minMap) drawNameAndHealthIfNeed();
    drawCarriedItemIfNeed();
    drawGameOverIfNeed();
    drawGameWinIfNeed();
}
```

## 效果

![显示当前关卡][1]

[1]: images/地宫探险30.gif

## 附录
