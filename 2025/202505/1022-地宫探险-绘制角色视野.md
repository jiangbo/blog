# 1022-地宫探险-绘制角色视野

## 目标

在绘制地图的时候，现在不是全部绘制，而是根据角色的位置，只绘制角色周围的视野。

## 环境

- Time 2025-11-19
- Zig 0.15.1

## 参考

1. <https://pragprog.com/titles/hwrust/hands-on-rust/>
2. 《Rust游戏开发实战》

## 想法

把之前的地图全量绘制部分删除了，根据角色的位置来进行绘制。

## map.zig

根据角色的位置进行绘制。

```zig
pub fn draw() void {
    drawPlayerView();
}

fn drawPlayerView() void {
    const pos = ecs.w.getIdentity(Player, TilePosition).?;
    const viewField: u8 = 4;
    const maxX = @min(WIDTH, pos.x + viewField + 1);
    const maxY = @min(HEIGHT, pos.y + viewField + 1);

    for (pos.x -| viewField..maxX) |x| {
        for (pos.y -| viewField..maxY) |y| {
            const index = indexUsize(x, y);
            const tex = getTextureFromTile(tiles[index]);
            camera.draw(tex, getPositionFromIndex(index));
        }
    }
}
```

## 效果

![绘制角色视野][1]

[1]: images/地宫探险17.gif

## 附录
