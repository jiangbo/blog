# 1029-地宫探险-新的主题风格

## 目标

支持新的主题风格，森林场景。

## 环境

- Time 2025-11-21
- Zig 0.15.1

## 参考

1. <https://pragprog.com/titles/hwrust/hands-on-rust/>
2. 《Rust游戏开发实战》

## 想法

没有接口，所以直接 if 进行判断。

## map.zig

两种风格，一个地宫，一个森林。

```zig
const Theme = enum { dungeon, forest };
var theme: Theme = undefined;

pub fn init() void {
    texture = gfx.loadTexture("assets/dungeonfont.png", .init(512, 512));
    theme = if (zhu.randomBool()) .dungeon else .forest;

    switch (zhu.randomInt(u8, 0, 3)) {
        1 => builder.buildRooms(&tiles, &spawns),
        2 => builder.buildAutometa(&tiles, &spawns),
        else => builder.buildDrunkard(&tiles, &spawns),
    }

    @memset(&walks, false);
    updateDistance(spawns[0]);

    var max: u8 = 0;
    for (&distances, 0..) |*line, y| {
        for (line, 0..) |value, x| {
            if (value == 0xFF or value <= max) continue;
            max = value;
            amuletPos = .{ .x = @intCast(x), .y = @intCast(y) };
        }
    }

    applyPrefab();
}

pub fn getTextureFromTile(tile: Tile) gfx.Texture {
    var index: usize = @intFromEnum(tile);
    if (theme == .forest) {
        if (tile == .wall) index = 34;
        if (tile == .floor) index = 59;
    }

    const row: f32 = @floatFromInt(index / TILE_PER_ROW);
    const col: f32 = @floatFromInt(index % TILE_PER_ROW);
    const pos = gfx.Vector.init(col, row).mul(TILE_SIZE);
    return texture.subTexture(.init(pos, TILE_SIZE));
}
```

## 效果

![新的主题风格][1]

[1]: images/地宫探险24.gif

## 附录
