# 1091-幽灵逃生-实现退出按钮

## 目标

实现一个按钮的功能，有三种状态，点击的时候，可以产生事件。

## 环境

- Time 2026-01-13
- Zig 0.15.1

## 参考

1. <https://www.bilibili.com/video/BV1jf9XYQEhW>

## 想法

先实现一个最简单的按钮，后面考虑多个按钮的情况。

## title.zig

实现了退出按钮。

```zig
const std = @import("std");
const zhu = @import("zhu");

const camera = zhu.camera;

const background = zhu.graphics.imageId("UI/Textfield_01.png");

const Button = struct {
    normal: zhu.graphics.ImageId,
    hover: zhu.graphics.ImageId,
    pressed: zhu.graphics.ImageId,
};

const ButtonState = enum { normal, hover, pressed };
const buttonSize = zhu.Vector2.xy(192, 64);
const buttons: [1]Button = .{
    Button{
        .normal = zhu.graphics.imageId("UI/A_Quit1.png"),
        .hover = zhu.graphics.imageId("UI/A_Quit2.png"),
        .pressed = zhu.graphics.imageId("UI/A_Quit3.png"),
    },
};
var buttonIndex: ?u8 = null;
var buttonState: ButtonState = .normal;

pub fn init() void {}

pub fn deinit() void {}

var time: f32 = 0;
pub fn update(delta: f32) void {
    time += delta;

    const mousePos = zhu.window.mousePosition;

    const pos = zhu.Vector2.xy(750, 500);
    const buttonArea = zhu.Rect.init(pos, buttonSize);
    buttonIndex = null;
    if (buttonArea.contains(mousePos)) {
        // hover 状态
        buttonIndex = 0;
        buttonState = if (zhu.window.isMouseDown(.LEFT)) .pressed else .hover;

        if (zhu.window.isMouseRelease(.LEFT)) {
            // 点击按钮，退出游戏
            zhu.window.exit();
        }
    }
}

pub fn draw() void {
    drawButton();

    // 边框
    var size = zhu.window.logicSize.sub(.xy(60, 60));
    camera.drawRectBorder(.init(.xy(30, 30), size), 10, .{
        .r = zhu.math.sinInt(u8, time * 0.9, 100, 255),
        .g = zhu.math.sinInt(u8, time * 0.8, 100, 255),
        .b = zhu.math.sinInt(u8, time * 0.7, 100, 255),
        .a = 255,
    });

    // 标题
    const basicPos = zhu.Vector2.xy(320, 100); // 定位位置
    size = zhu.window.logicSize.div(.xy(2, 3));

    // 先绘制图片，再绘制文字，减少批量绘制次数
    camera.drawOption(background, basicPos, .{ .size = size });
    camera.drawOption(background, basicPos.addXY(220, 285), .{
        .size = .xy(200, 60),
    });

    var pos = basicPos.addXY(150, 80);
    zhu.text.drawOption("幽 灵 逃 生", pos, .{ .size = 64 });

    pos = basicPos.addXY(240, 300);
    zhu.text.drawText("最高分：", pos);
    zhu.text.drawNumber(77, pos.addX(125));
}

const imageId = zhu.graphics.imageId;
fn drawButton() void {
    const pos = zhu.Vector2.xy(750, 500);

    if (buttonIndex != null) {
        if (buttonState == .pressed) {
            camera.drawOption(buttons[0].pressed, pos, .{
                .size = buttonSize,
            });
        } else if (buttonState == .hover) {
            camera.drawOption(buttons[0].hover, pos, .{
                .size = buttonSize,
            });
        }
    } else {
        camera.drawOption(buttons[0].normal, pos, .{
            .size = buttonSize,
        });
    }
}
```

## 效果

![实现退出按钮][1]

[1]: images/幽灵逃生23.gif

## 附录
