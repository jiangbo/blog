# 1102-阳光岛-实现视差背景

## 目标

实现两个背景图片层的视差滚动。

## 环境

- Time 2026-01-21
- Zig 0.15.1

## 参考

1. <https://www.bilibili.com/video/BV1jf9XYQEhW>

## 想法

上一个教程，跳过了星空背景的视差滚动，决定性能开销太大，目前在这里来实现。

## level.zig

定义了一个新的模块，关卡模块来加载 tiled 地图数据，并且进行显示。

```zig
const std = @import("std");
const zhu = @import("zhu");

const window = zhu.window;
const batch = zhu.batch;
const tiled = zhu.extend.tiled;

const level1: tiled.Map = @import("zon/level1.zon");

pub fn draw() void {
    for (level1.layers) |*layer| {
        switch (layer.type) {
            .image => drawImageLayer(layer),
            else => {},
        }
    }
}

fn drawImageLayer(layer: *const tiled.Layer) void {
    zhu.camera.modeEnum = .window;
    defer zhu.camera.modeEnum = .world;

    if (layer.repeatY) {
        const posY = zhu.camera.position.y * layer.parallaxY;
        var y = -@mod(posY, layer.height);
        while (y < window.size.y) : (y += layer.height) {
            batch.draw(layer.image, .xy(0, y));
        }
    }

    if (layer.repeatX) {
        const posX = zhu.camera.position.x * layer.parallaxX;
        var x = -@mod(posX, layer.width);
        while (x < window.size.x) : (x += layer.width) {
            batch.draw(layer.image, .xy(x, 0));
        }
    }
}
```

## 效果

![实现视差背景][1]

[1]: images/阳光岛02.gif

## 附录
