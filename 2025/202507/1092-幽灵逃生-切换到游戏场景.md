# 1092-幽灵逃生-切换到游戏场景

## 目标

显示了三个按钮，之前实现了退出按钮的功能，现在实现切换场景的按钮功能。

## 环境

- Time 2026-01-14
- Zig 0.15.1

## 参考

1. <https://www.bilibili.com/video/BV1jf9XYQEhW>

## 想法

实现了多个按钮的功能。目前在考虑绘制的时候，直接指定具体尺寸好还是指定缩放比例比较好。

## title.zig

实现了切换场景按钮。

```zig
const std = @import("std");
const zhu = @import("zhu");

const camera = zhu.camera;

const scene = @import("scene.zig");

const background = zhu.graphics.imageId("UI/Textfield_01.png");

const Button = struct {
    normal: zhu.graphics.ImageId,
    hover: zhu.graphics.ImageId,
    pressed: zhu.graphics.ImageId,
};

const ButtonState = enum { normal, hover, pressed };
const buttonSize = zhu.Vector2.xy(192, 64);
const buttonPosition = zhu.Vector2.xy(350, 500);
const buttons: [3]Button = .{
    Button{
        .normal = zhu.graphics.imageId("UI/A_Start1.png"),
        .hover = zhu.graphics.imageId("UI/A_Start2.png"),
        .pressed = zhu.graphics.imageId("UI/A_Start3.png"),
    },
    Button{
        .normal = zhu.graphics.imageId("UI/A_Credits1.png"),
        .hover = zhu.graphics.imageId("UI/A_Credits2.png"),
        .pressed = zhu.graphics.imageId("UI/A_Credits3.png"),
    },
    Button{
        .normal = zhu.graphics.imageId("UI/A_Quit1.png"),
        .hover = zhu.graphics.imageId("UI/A_Quit2.png"),
        .pressed = zhu.graphics.imageId("UI/A_Quit3.png"),
    },
};
var buttonIndex: ?usize = null;
var buttonState: ButtonState = .normal;

pub fn init() void {}

pub fn deinit() void {}

var time: f32 = 0;
pub fn update(delta: f32) void {
    time += delta;

    const mousePos = zhu.window.mousePosition;

    for (0..buttons.len) |i| {
        const index: f32 = @floatFromInt(i);
        const pos = buttonPosition.addX(index * 200);
        const buttonArea = zhu.Rect.init(pos, buttonSize);

        const hover = buttonArea.contains(mousePos);
        const press = zhu.window.isMouseDown(.LEFT);
        if (hover) {
            if (zhu.window.isMouseRelease(.LEFT)) triggerButton(i);
            buttonIndex = i;
            buttonState = if (press) .pressed else .hover;
            break;
        } else if (!press) {
            buttonState = .normal;
        }
    }
}

fn triggerButton(index: usize) void {
    switch (index) {
        0 => scene.isTitleScene = false, // 开始游戏
        1 => {
            // 显示版权信息
            // zhu.window.changeScene("credits");
        },
        2 => zhu.window.exit(), // 退出游戏
        else => unreachable,
    }
}

pub fn draw() void {
    drawButton();

    // 边框
    var size = zhu.window.logicSize.sub(.xy(60, 60));
    camera.drawRectBorder(.init(.xy(30, 30), size), 10, .{
        .r = zhu.math.sinInt(u8, time * 0.9, 100, 255),
        .g = zhu.math.sinInt(u8, time * 0.8, 100, 255),
        .b = zhu.math.sinInt(u8, time * 0.7, 100, 255),
        .a = 255,
    });

    // 标题
    const basicPos = zhu.Vector2.xy(320, 100); // 定位位置
    size = zhu.window.logicSize.div(.xy(2, 3));

    // 先绘制图片，再绘制文字，减少批量绘制次数
    camera.drawOption(background, basicPos, .{ .size = size });
    camera.drawOption(background, basicPos.addXY(220, 285), .{
        .size = .xy(200, 60),
    });

    var pos = basicPos.addXY(150, 80);
    zhu.text.drawOption("幽 灵 逃 生", pos, .{ .size = 64 });

    pos = basicPos.addXY(240, 300);
    zhu.text.drawText("最高分：", pos);
    zhu.text.drawNumber(77, pos.addX(125));
}

const imageId = zhu.graphics.imageId;
fn drawButton() void {
    for (&buttons, 0..buttons.len) |button, i| {
        const index: f32 = @floatFromInt(i);
        const pos = buttonPosition.addX(index * 200);

        if (i == buttonIndex and buttonState != .normal) {
            if (buttonState == .pressed) {
                camera.drawOption(button.pressed, pos, .{
                    .size = buttonSize,
                });
            } else if (buttonState == .hover) {
                camera.drawOption(button.hover, pos, .{
                    .size = buttonSize,
                });
            }
        } else {
            camera.drawOption(button.normal, pos, .{
                .size = buttonSize,
            });
        }
    }
}
```

## 效果

![切换到游戏场景][1]

[1]: images/幽灵逃生24.gif

## 附录
