# 1130-阳光岛-向上攀爬楼梯

## 目标

实现了角色可以向上攀爬楼梯。

## 环境

- Time 2026-01-29
- Zig 0.15.1

## 参考

1. <https://www.bilibili.com/video/BV1jf9XYQEhW>

## 想法

各种状态越来越多，逻辑越来越绕，有点弄不明白了，看来需要找更好的代码组织形式。

## map.zig

只粘贴了攀爬状态的代码。

```zig
const ClimbState = struct {
    var animation: zhu.graphics.Animation = undefined;
    const frames = zhu.graphics.loopFramesX(4, imageSize, 0.1);
    const speed = 100;

    pub fn init() void {
        const climbImage = image.sub(.init(.xy(0, 64), .xy(128, 32)));
        animation = .init(climbImage, &frames);
    }

    fn enter() void {
        std.log.info("enter climb", .{});
        velocity = .zero;
        force = .zero;
    }

    fn update(delta: f32) void {
        if (zhu.window.isKeyDown(.W)) {
            velocity.y = -speed;
        } else if (zhu.window.isKeyDown(.S)) {
            velocity.y = speed;
        } else if (zhu.window.isKeyDown(.A)) {
            velocity.x = -speed;
        } else if (zhu.window.isKeyDown(.D)) {
            velocity.x = speed;
        } else velocity = .zero;

        if (velocity.x != 0 or velocity.y != 0) {
            animation.loopUpdate(delta);
        }

        if (!map.isTouchLadder(position, tiledObject.size)) {
            changeState(.fall);
        }
    }

    fn draw() void {
        drawPlayer(animation.currentImage());
    }
};
```

## 效果

![向上攀爬楼梯][1]

[1]: images/阳光岛28.png

## 附录
