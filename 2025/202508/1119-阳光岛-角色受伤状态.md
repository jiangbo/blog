# 1119-阳光岛-角色受伤状态

## 目标

新增角色的受伤状态。

## 环境

- Time 2026-01-26
- Zig 0.15.1

## 参考

1. <https://www.bilibili.com/video/BV1jf9XYQEhW>

## 想法

在之前已有的状态的基础上，新增受伤状态，并实现受伤时的动画效果。

## player.zig

只列出了角色受伤的状态的逻辑，其它的状态没有列出来。

```zig
const HurtState = struct {
    var animation: zhu.graphics.FrameAnimation = undefined;
    const frames = zhu.graphics.framesX(2, size, 0.1);
    var timer: zhu.Timer = .init(0.4);

    pub fn init() void {
        const hurtImage = image.sub(.init(.xy(0, 128), .xy(64, 32)));
        animation = .init(hurtImage, &frames);
    }

    fn enter() void {
        std.log.info("enter hurt", .{});
        var vel = hurtVelocity;
        if (flip) vel.x = -vel.x;
        velocity = .xy(vel.x, velocity.y + vel.y);
        timer.elapsed = 0; // 重置计时器
    }

    fn update(delta: f32) void {
        animation.loopUpdate(delta);

        if (velocity.y == 0) {
            changeState(.idle);
        } else if (timer.isFinishedOnceUpdate(delta)) {
            changeState(.fall);
        }
    }

    fn draw() void {
        const hurtImage = animation.currentImage();
        batch.drawImage(hurtImage, position, .{ .flipX = flip });
    }
};
```

## 效果

![角色受伤状态][1]

[1]: images/阳光岛17.gif
## 附录
